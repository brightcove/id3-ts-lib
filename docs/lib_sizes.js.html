<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/sizes.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/sizes.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Common sizes and size-calculators
 * @module lib/sizes
 */

// Byte lengths of various components of MPEG2TS bitstreams
const TS_PACKET = 188;
const PAT = TS_PACKET;
const PMT = TS_PACKET;
const PES_HEADER = 9;
const PTS = 5;
const TS_HEADER_NO_ADAPTATION = 4;

// Byte length of a byte
// This is called out here to make it clear why we are adding 1 to various lengths in the maths below
const NULL_BYTE = 1;

// Byte lengths of various componenets of ID3 tags
const ID3_TAG_HEADER = 10;
const ID3_FRAME_HEADER = 10;
const ID3_FRAME_TEXT_ENCODING = 1;
const ID3_FRAME_TXXX_HEADER = ID3_FRAME_HEADER + ID3_FRAME_TEXT_ENCODING + NULL_BYTE;

/**
 * Compute the value that should be put into the TXXX frame header's length field
 *
 * @param {Number} payloadLength - The length in bytes of the intended ID3 contents
 * @param {Number?} descriptionLength - The length of the optional TXXX-frame description field
 */
exports.calculateId3FrameLength = (payloadLength, descriptionLength = 0) => ID3_FRAME_HEADER + ID3_FRAME_TEXT_ENCODING + descriptionLength + NULL_BYTE + payloadLength + NULL_BYTE;

/**
 * Compute the value that should be put into the ID3 tag header's length field
 *
 * @param {Number} payloadLength - The length in bytes of the intended ID3 contents
 * @param {Number?} descriptionLength - The length of the optional TXXX-frame description field
 */
exports.calculateId3TagLength = (payloadLength, descriptionLength = 0) => ID3_TAG_HEADER + calculateId3FrameLength(payloadLength, descriptionLength);

/**
 * Compute the size of the final TS segment based on the intended ID3 payload length
 *
 * @param {Number} payloadLength - The length in bytes of the intended ID3 contents
 * @param {Number?} descriptionLength - The length of the optional TXXX-frame description field
 */
exports.calculateOutputBufferLength = (payloadLength, descriptionLength = 0) => {
  const ID3 = calculateId3TagLength(payloadLength, descriptionLength);
  const UNPADDED_PES = PES_HEADER + PTS + ID3;

  const PAYLOAD = Math.ceil(UNPADDED_PES / 184) * 188;

  return PAT + PMT + PAYLOAD;
};

exports.sizeOf = {
  PAT,
  PMT,
  ID3_TAG_HEADER,
  ID3_FRAME_HEADER,
  ID3_FRAME_TXXX_HEADER,
  ID3_FRAME_TEXT_ENCODING,
  NULL_BYTE,
  PES_HEADER,
  PTS,
  TS_PACKET,
  TS_HEADER_NO_ADAPTATION,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_crc32.html">lib/crc32</a></li><li><a href="module-lib_id3.html">lib/id3</a></li><li><a href="module-lib_pat.html">lib/pat</a></li><li><a href="module-lib_pes.html">lib/pes</a></li><li><a href="module-lib_pmt.html">lib/pmt</a></li><li><a href="module-lib_sizes.html">lib/sizes</a></li><li><a href="module-lib_ts.html">lib/ts</a></li></ul><h3>Global</h3><ul><li><a href="global.html#fillOutTSHeaders">fillOutTSHeaders</a></li><li><a href="global.html#generateID3Packets">generateID3Packets</a></li><li><a href="global.html#generateID3Segment">generateID3Segment</a></li><li><a href="global.html#packetEndBoundary">packetEndBoundary</a></li><li><a href="global.html#writeHeaderPadding">writeHeaderPadding</a></li><li><a href="global.html#writeID3TagChunked">writeID3TagChunked</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Mar 21 2019 23:47:40 GMT-0700 (Mountain Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
